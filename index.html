<html>
	<head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <title>WarpScan</title>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.0.0/semantic.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.0.0/semantic.min.css">
	</head>
	<body>

    <div class="ui container">

        <div id="message" class="ui hidden message"></div>

        <div id="start" class="ui">
            <h1 class="ui center aligned header">Scan</h1>
            <form class="ui form" action="javascript:return false;">
                <input name="tag" type="text" autofocus>
                <button class="scan ui button">Submit</button>
            </form>
        </div>

        <div id="unknown" class="ui hidden message">
            <h1 class="ui center aligned header">Unknown item</h1>
            <h2 class="tag"></h2>
            <button class="unknownAdd ui button">Add</button>
            <button class="cancel ui button">Cancel</button>
        </div>

        <div id="new" class="ui hidden message">
            <form class="ui form" action="javascript:return false;">
                <div class="field">
                    <label>Tag</label>
                    <p class="tag"></p>
                </div>
                <div class="field">
                    <label>Name</label>
                    <input type="text" name="name">
                </div>
                <div class="field">
                    <label>Amount</label>
                    <input type="number" name="amount" value="1">
                </div>
                <button class="newSubmit ui button" type="submit">Submit</button>
            </form>
        </div>

        <div id="item" class="ui hidden message">
            <h1 class="ui center aligned header name"></h1>
            <div class="ui label">
                Tag
                <div class="detail tag"></div>
            </div>
            <div class="ui label">
                Amount
                <div class="detail amount"></div>
            </div>

            <form class="ui form" action="javascript:return false;">
                <div class="field">
                    <label>Amount</label>
                    <input type="number" name="amount" value="1">
                </div>
                <button class="itemRemove ui negative button" type="submit">Remove from stock</button>
                <button class="itemAdd ui positive button" type="submit">Add to stock</button>
            </form>
        </div>

    </div>

    <script type="text/javascript">

        function getItem(tag) {
            $.ajax({
                type: 'GET',
                url: 'index.php/get/' + tag,
                async: false,
                dataType: 'json',
                success: function(data) {
                    $('.tag').html(tag);
                    $('#start').addClass('hidden message');
                    if(data == false) {
                        $('#unknown').removeClass('hidden message');
                    }
                    else {
                        console.log(data);
                        $('.name').html(data[0]['name']);
                        $('.amount').html(data[0]['amount']);
                        $('#item').removeClass('hidden message');
                    }
                }
            });
        }

        function newItem(tag, name, amount) {
            $.ajax({
                type: 'GET',
                url: 'index.php/new/' + tag + '/' + name + '/' + amount,
                async: false,
                dataType: 'json',
                success: function(data) {
                    $('#message').html('New item successfully added!');
                    $('#message').removeClass('hidden message');
                    $('#message').addClass('success message');
                    $('#new').addClass('hidden message');
                    $('#start').removeClass('hidden message');
                }
            });
        }

        function addItem(tag, amount) {
            $.ajax({
                type: 'GET',
                url: 'index.php/add/' + tag + '/' + amount,
                async: false,
                dataType: 'json',
                success: function(data) {
                    $('#message').html('Item inventory successfully updated!');
                    $('#message').removeClass('hidden message');
                    $('#message').addClass('success message');
                    $('#item').addClass('hidden message');
                    $('#start').removeClass('hidden message');
                }
            });
        }

        function removeItem(tag, amount) {
            $.ajax({
                type: 'GET',
                url: 'index.php/remove/' + tag + '/' + amount,
                async: false,
                dataType: 'json',
                success: function(data) {
                    $('#message').html('Item inventory successfully updated!');
                    $('#message').removeClass('hidden message');
                    $('#message').addClass('success message');
                    $('#item').addClass('hidden message');
                    $('#start').removeClass('hidden message');
                }
            });
        }

        $('.scan').click(function () {
            var tag = $('#start').find('input[name="tag"]').val();
            getItem(tag);
        });

        $('.unknownAdd').click(function () {
            $('#unknown').addClass('hidden message');
            $('#new').removeClass('hidden message');
        });

        $('.cancel').click(function () {
            location.reload(true);
        });

        $('.newSubmit').click(function () {
            var tag = $('.tag').html();
            var name = $('#new').find('input[name="name"]').val();
            var amount = $('#new').find('input[name="amount"]').val();
            newItem(tag, name, amount);
        });

        $('.itemAdd').click(function () {
            var tag = $('.tag').html();
            var amount = $('#new').find('input[name="amount"]').val();
            addItem(tag, amount);
        });

        $('.itemRemove').click(function () {
            var tag = $('.tag').html();
            var amount = $('#new').find('input[name="amount"]').val();
            removeItem(tag, amount);
        });

    </script>
	
	</body>
</html>